<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <link rel="stylesheet" href="login-css.css"> 
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>   
    <title>Demo</title>
</head>

<body>
    <div class="container">
        <div class="jumbotron">
            <h1 class="display-4 logged-out">Non connect√©</h1>
            <h1 class="display-4 d-none logged-in">Bonjour</h1>
            <hr class="my-4">

            <div class="logged-out">
                <h1>Login to App</h1>
                <form method="post" action="">
                  <p><input type="text" name="email" id="email" placeholder="Email"></p>
                  <p><input type="password" name="password" id="password" placeholder="Password"></p>
                  <button id="test">Test Loggedin</button>
                  <button id="submit">submit</button>
                 <!-- <p class="submit"><input type="submit" name="commit" value="Login"></p> -->
                  
                </form>


            <h1>register to App</h1>
                <form method="post" action="">
                  <p><input type="text" name="email" value="" placeholder="Email"></p>
                  <p><input type="password" name="password" value="" placeholder="Password"></p>
                  <p><input type="text" name="role" value="" placeholder="Role"></p>

                  <p class="submit"><input type="submit" name="commit" value="submit"></p>
      
                </form> 
            </div>
              
        </div>
    



    <div id="posts" class="logged-in"></div>      
    </div>
    
    <!--<script src="script.js"></script>-->

   
    <script>
        $(document).ready(function () {
            $('#test').click(function() {
             $.ajax({
              type: "GET",
              url: "http://localhost:3000/posts",
              beforeSend: function(xhr) {
                if (localStorage.token) {
                 xhr.setRequestHeader('Authorization', 'Bearer ' + localStorage.token);
                  }
             },
             success: function(data) {
                alert('Hello ' + data.email + '! You have successfully accessed to your application.');
             },
              error: function() {
               alert("Sorry, you are not logged in.");
             }
             });
            });


            $("#submit").click(function (event ) {
                event.preventDefault()
                $.ajax({
                    type: "POST",
                    url: "http://localhost:3000/user/login",
                    data: {email: $("#email").val(), password: $("#password").val()},
                    success: function (result) {

                        localStorage.token = result.token;
                        console.log(result)
                        callApi(result.token);
                        //alert('Got a token from the server! Token: ' + result.token);
                    },
                    error: function () {
                        alert("login error" );
                    }
                });
            });

            function callApi(token) {
                $.ajax({
                type: "GET",
                url: "http://localhost:3000/posts",
                headers: {
                    Authorization: token
                },
                //dataType: 'json',
                success: function (result, status, xhr) {
                    showData();
                },
                error: function (xhr, status, error) {
                     alert(error);
                }
            });
            }

        function showData() {

        }
     
        });
    </script>
</body>

</html>